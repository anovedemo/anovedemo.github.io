<?xml version="1.0" encoding="utf-8"?>
<draftsman project-name="Demo" xmlns="https://tracepaper.draftsman.io">
	<global>
		<pattern name="IndustryLink" regex="^{{IndustryArn}}(;{{IndustryArn}})*$"></pattern>
		<pattern name="ControlFrameworkArn" regex="^controlframework:[a-z0-9]+$"></pattern>
		<pattern name="CompanyArn" regex="^company:[a-z]+$"></pattern>
		<pattern name="IndustryArn" regex="^industry:[a-z]+$"></pattern>
		<pattern name="RequirementArn" regex="^{{ControlFrameworkArn}}:[a-z0-9]+$"></pattern>
		<pattern name="ControlFrameworkType" regex="^(standard|regulation|framework)$"></pattern>
		<expression name="extractRoleFromArn" type="ActorEventRole" input="arn;role" expression="${arn.split(':')[0]}:${arn.split(':')[1]}:role"></expression>
	</global>
	<events>
		<event graphql-namespace="Requirement" graphql-name="add" name="AddRequirementRequested" authorization="role" type="ActorEvent" role="administrator">
			<field name="arn" type="String" pattern="{{RequirementArn}}"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="mandatory" type="Boolean"></field>
			<field name="summary" type="String"></field>
		</event>
		<event graphql-namespace="Industry" graphql-name="add" name="AddIndustryRequested" authorization="role" type="ActorEvent" role="administrator">
			<field name="arn" type="String" pattern="{{IndustryArn}}"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
		</event>
		<event graphql-namespace="Company" graphql-name="create" name="CreateCompanyRequested" authorization="authenticated" type="ActorEvent">
			<field name="arn" type="String" pattern="{{CompanyArn}}"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="companySize" type="Int"></field>
			<field name="revenue" type="String"></field>
			<field name="industry" type="String" pattern="{{IndustryLink}}"></field>
			<field name="user" type="String" auto-fill="username"></field>
		</event>
		<event graphql-namespace="ControlFramework" graphql-name="add" name="AddControlFrameworkRequested" authorization="role" type="ActorEvent" role="administrator">
			<field name="arn" type="String" pattern="{{ControlFrameworkArn}}"></field>
			<field name="description" type="String"></field>
			<field name="name" type="String"></field>
			<field name="category" type="String" pattern="{{ControlFrameworkType}}"></field>
			<field name="edition" type="String"></field>
			<field name="unit" type="String"></field>
			<field name="acronym" type="String"></field>
			<field name="active" type="Boolean"></field>
		</event>
		<event name="RequirementCreated" source="Admin.Requirement" type="DomainEvent">
			<field name="arn" type="String"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="mandatory" type="Boolean"></field>
			<field name="summary" type="String"></field>
		</event>
		<event name="CompanyAdministratorCreated" source="Admin.User" type="DomainEvent">
			<field name="username" type="String"></field>
			<field name="companyArn" type="String"></field>
		</event>
		<event name="IndustryCreated" source="Admin.Industry" type="DomainEvent">
			<field name="arn" type="String"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
		</event>
		<event name="ControlFrameworkCreated" source="Admin.ControlFramework" type="DomainEvent">
			<field name="arn" type="String"></field>
			<field name="description" type="String"></field>
			<field name="name" type="String"></field>
			<field name="category" type="String"></field>
			<field name="edition" type="String"></field>
			<field name="unit" type="String"></field>
			<field name="acronym" type="String"></field>
			<field name="active" type="Boolean"></field>
		</event>
		<event name="CompanyCreated" source="Customer.Company" type="DomainEvent">
			<field name="arn" type="String"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="companySize" type="Int"></field>
			<field name="revenue" type="String"></field>
			<field name="industry" type="String"></field>
			<field name="user" type="String"></field>
		</event>
	</events>
	<domain>
		<subdomain name="Admin">
			<aggregate name="Requirement" business-key="arn" event-ttl="-1" snapshot-interval="100" backup-interval-days="0" backup-ttl-days="0">
				<field name="arn" type="String"></field>
				<field name="name" type="String"></field>
				<field name="description" type="String"></field>
				<field name="mandatory" type="Boolean"></field>
				<field name="summary" type="String"></field>
				<command name="Create" create-command="true">
					<trigger source="AddRequirementRequested" key-field="arn">
						<mapping target="arn" value="arn"></mapping>
						<mapping target="name" value="name"></mapping>
						<mapping target="description" value="description"></mapping>
						<mapping target="mandatory" value="mandatory"></mapping>
						<mapping target="summary" value="summary"></mapping>
					</trigger>
					<processor type="emit-event" id="2ebA8Y" ref="RequirementCreated">
						<mapping target="arn" value="#flow.arn"></mapping>
						<mapping target="name" value="#flow.name"></mapping>
						<mapping target="description" value="#flow.description"></mapping>
						<mapping target="mandatory" value="#flow.mandatory"></mapping>
						<mapping target="summary" value="#flow.summary"></mapping>
					</processor>
					<test-case name="AddNewRequirement" trigger-event="AddRequirementRequested">
						<input name="arn" value="controlframework:gdpr:req1" type="String"></input>
						<input name="name" value="req 1" type="String"></input>
						<input name="description" value="Hello World!" type="String"></input>
						<input name="mandatory" value="true" type="Boolean"></input>
						<input name="summary" value="hw" type="String"></input>
						<expected domain-event="RequirementCreated">
							<field value="controlframework:gdpr:req1" name="arn" type="String"></field>
							<field value="req 1" name="name" type="String"></field>
							<field value="Hello World!" name="description" type="String"></field>
							<field value="true" name="mandatory" type="Boolean"></field>
							<field value="hw" name="summary" type="String"></field>
						</expected>
						<expected-state pk="controlframework:gdpr:req1">{
  "arn": "controlframework:gdpr:req1",
  "name": "req 1",
  "description": "Hello World!",
  "mandatory": true,
  "summary": "hw"
}</expected-state>
					</test-case>
					<test-case name="AddDuplicateRequirement" trigger-event="AddRequirementRequested" expected-processing-status="error">
						<input name="arn" value="controlframework:gdpr:req1" type="String"></input>
						<input name="name" value="req 1" type="String"></input>
						<input name="description" value="Hello World!" type="String"></input>
						<input name="mandatory" value="true" type="Boolean"></input>
						<input name="summary" value="hw" type="String"></input>
						<state>{
      "arn": "controlframework:gdpr:req1",
      "version": 1
      }</state>
					</test-case>
				</command>
				<event-handler on="RequirementCreated">
					<mapping target="arn" operand="set" value="arn"></mapping>
					<mapping target="name" operand="set" value="name"></mapping>
					<mapping target="description" operand="set" value="description"></mapping>
					<mapping target="mandatory" operand="set" value="mandatory"></mapping>
					<mapping target="summary" operand="set" value="summary"></mapping>
				</event-handler>
			</aggregate>
			<aggregate name="User" business-key="username" event-ttl="-1" snapshot-interval="100" backup-interval-days="0" backup-ttl-days="0">
				<field name="username" type="String"></field>
				<field name="firstName" type="String"></field>
				<field name="lastName" type="String"></field>
				<command name="CreateFirstCompanyUser">
					<trigger source="CompanyCreated" key-field="user">
						<mapping target="arn" value="arn"></mapping>
						<mapping target="user" value="user"></mapping>
					</trigger>
					<processor type="emit-event" id="YLK80V" ref="CompanyAdministratorCreated">
						<mapping target="username" value="#flow.user"></mapping>
						<mapping target="companyArn" value="#flow.arn"></mapping>
					</processor>
					<test-case name="CreateNewUser" trigger-event="CompanyCreated">
						<input name="arn" value="company:draftsman" type="String"></input>
						<input name="name" value="dummy" type="String"></input>
						<input name="description" value="dummy" type="String"></input>
						<input name="companySize" value="2" type="Int"></input>
						<input name="revenue" value="dummy" type="String"></input>
						<input name="industry" value="dummy" type="String"></input>
						<input name="user" value="j.doe" type="String"></input>
						<expected domain-event="CompanyAdministratorCreated">
							<field value="j.doe" name="username" type="String"></field>
							<field value="company:draftsman" name="companyArn" type="String"></field>
						</expected>
						<expected-state pk="j.doe">{
  "username": "j.doe",
  "companies": {
    "company:draftsman": {
      "arn": "company:draftsman",
      "employeeArn": "company:draftsman:employee:j.doe"
    }
  }
}</expected-state>
					</test-case>
					<test-case name="AddCompanyToUser" trigger-event="CompanyCreated">
						<input name="arn" value="company:draftsman" type="String"></input>
						<input name="name" value="dummy" type="String"></input>
						<input name="description" value="dummy" type="String"></input>
						<input name="companySize" value="2" type="Int"></input>
						<input name="revenue" value="dummy" type="String"></input>
						<input name="industry" value="dummy" type="String"></input>
						<input name="user" value="j.doe" type="String"></input>
						<expected domain-event="CompanyAdministratorCreated">
							<field value="j.doe" name="username" type="String"></field>
							<field value="company:draftsman" name="companyArn" type="String"></field>
						</expected>
						<expected-state pk="j.doe">{
  "username": "j.doe",
  "companies": {
    "company:draftsman": {
      "arn": "company:draftsman",
      "employeeArn": "company:draftsman:employee:j.doe"
    },
      "company:anove": {
      "arn": "company:anove"
    }
  }
}</expected-state>
						<state>{
  "username": "j.doe",
  "companies": {
    "company:anove": {
      "arn": "company:anove"
    }
  }
}</state>
					</test-case>
				</command>
				<event-handler on="CompanyAdministratorCreated" code='self.username = event.username|LB|self.companies[event.companyArn] = {|LB|    "arn": event.companyArn,|LB|    "employeeArn": event.companyArn + ":employee:" + event.username|LB|}|LB|'></event-handler>
				<nested-object name="companies" business-key="arn">
					<field name="arn" type="String"></field>
					<field name="employeeArn" type="String"></field>
				</nested-object>
			</aggregate>
			<aggregate name="Industry" business-key="fieldName" event-ttl="-1" snapshot-interval="100" backup-interval-days="0" backup-ttl-days="0">
				<field name="arn" type="String"></field>
				<field name="name" type="String"></field>
				<field name="description" type="String"></field>
				<command name="Create" create-command="true">
					<trigger source="AddIndustryRequested" key-field="arn">
						<mapping target="arn" value="arn"></mapping>
						<mapping target="name" value="name"></mapping>
						<mapping target="description" value="description"></mapping>
					</trigger>
					<processor type="emit-event" id="U8J057" ref="IndustryCreated">
						<mapping target="arn" value="#flow.arn"></mapping>
						<mapping target="name" value="#flow.name"></mapping>
						<mapping target="description" value="#flow.description"></mapping>
					</processor>
					<processor type="validator" id="r8n5VM" condition='flow.name != ""' exception="Name may not be empty"></processor>
					<processor type="validator" id="1HirZZ" condition='flow.description != ""' exception="Description may not be empty"></processor>
					<test-case name="AddNewIndustry" trigger-event="AddIndustryRequested">
						<input name="arn" value="industry:automotive" type="String"></input>
						<input name="name" value="Automotive" type="String"></input>
						<input name="description" value="The automotive industry" type="String"></input>
						<expected domain-event="IndustryCreated">
							<field value="industry:automotive" name="arn" type="String"></field>
							<field value="Automotive" name="name" type="String"></field>
							<field value="The automotive industry" name="description" type="String"></field>
						</expected>
						<expected-state pk="industry:automotive">{
  "arn": "industry:automotive",
  "name": "Automotive",
  "description": "The automotive industry"
}</expected-state>
					</test-case>
					<test-case name="AddDuplicateIndustry" trigger-event="AddIndustryRequested" expected-processing-status="error">
						<input name="arn" value="industry:automotive" type="String"></input>
						<input name="name" value="Hello World!" type="String"></input>
						<input name="description" value="None" type="String"></input>
						<state>{
  "arn": "industry:automotive",
  "name": "Automotive",
  "description": "The automotive industry",
      "version": 1
}</state>
					</test-case>
				</command>
				<event-handler on="IndustryCreated">
					<mapping target="arn" operand="set" value="arn"></mapping>
					<mapping target="name" operand="set" value="name"></mapping>
					<mapping target="description" operand="set" value="description"></mapping>
				</event-handler>
			</aggregate>
			<aggregate name="ControlFramework" business-key="arn" event-ttl="-1" snapshot-interval="100" backup-interval-days="0" backup-ttl-days="0">
				<field name="arn" type="String"></field>
				<field name="description" type="String"></field>
				<field name="name" type="String"></field>
				<field name="category" type="String"></field>
				<field name="edition" type="String"></field>
				<field name="unit" type="String"></field>
				<field name="acronym" type="String"></field>
				<field name="active" type="Boolean"></field>
				<command name="Create" create-command="true">
					<trigger source="AddControlFrameworkRequested" key-field="arn">
						<mapping target="arn" value="arn"></mapping>
						<mapping target="description" value="description"></mapping>
						<mapping target="name" value="name"></mapping>
						<mapping target="category" value="category"></mapping>
						<mapping target="edition" value="edition"></mapping>
						<mapping target="unit" value="unit"></mapping>
						<mapping target="acronym" value="acronym"></mapping>
						<mapping target="active" value="active"></mapping>
					</trigger>
					<processor type="emit-event" id="SMJwSw" ref="ControlFrameworkCreated">
						<mapping target="arn" value="#flow.arn"></mapping>
						<mapping target="description" value="#flow.description"></mapping>
						<mapping target="name" value="#flow.name"></mapping>
						<mapping target="category" value="#flow.category"></mapping>
						<mapping target="edition" value="#flow.edition"></mapping>
						<mapping target="unit" value="#flow.unit"></mapping>
						<mapping target="acronym" value="#flow.acronym"></mapping>
						<mapping target="active" value="#flow.active"></mapping>
					</processor>
					<processor type="validator" id="RUrSia" condition='flow.name != ""' exception="Name may not be empty"></processor>
					<test-case name="AddControlFramework" trigger-event="AddControlFrameworkRequested">
						<input name="arn" value="controlframework:mycontrol" type="String"></input>
						<input name="description" value="n.v.t." type="String"></input>
						<input name="name" value="my control" type="String"></input>
						<input name="category" value="framework" type="String"></input>
						<input name="edition" value="1.0" type="String"></input>
						<input name="unit" value="n.v.t." type="String"></input>
						<input name="acronym" value="NVT" type="String"></input>
						<input name="active" value="True" type="Boolean"></input>
						<expected domain-event="ControlFrameworkCreated">
							<field value="controlframework:mycontrol" name="arn" type="String"></field>
						</expected>
						<expected-state pk="controlframework:mycontrol">{
  "arn": "controlframework:mycontrol",
  "description": "n.v.t.",
  "name": "my control",
  "category": "framework",
  "edition": "1.0",
  "unit": "n.v.t.",
  "acronym": "NVT",
  "active": true
}</expected-state>
					</test-case>
					<test-case name="AddDuplicateControlFramework" trigger-event="AddControlFrameworkRequested" expected-processing-status="error">
						<state>{
  "arn": "controlframework:mycontrol",
        "version": 1
}</state>
						<input name="arn" value="controlframework:mycontrol" type="String"></input>
						<input name="description" value="n.v.t." type="String"></input>
						<input name="name" value="my control" type="String"></input>
						<input name="category" value="framework" type="String"></input>
						<input name="edition" value="1.0" type="String"></input>
						<input name="unit" value="n.v.t." type="String"></input>
						<input name="acronym" value="NVT" type="String"></input>
						<input name="active" value="True" type="Boolean"></input>
						<input name="requirements" type="NestedObject">[
  {
    "name": "myreq",
    "description": "Hello World"
  }
]</input>
					</test-case>
				</command>
				<event-handler on="ControlFrameworkCreated">
					<mapping target="arn" operand="set" value="arn"></mapping>
					<mapping target="description" operand="set" value="description"></mapping>
					<mapping target="name" operand="set" value="name"></mapping>
					<mapping target="category" operand="set" value="category"></mapping>
					<mapping target="edition" operand="set" value="edition"></mapping>
					<mapping target="unit" operand="set" value="unit"></mapping>
					<mapping target="acronym" operand="set" value="acronym"></mapping>
					<mapping target="active" operand="set" value="active"></mapping>
				</event-handler>
			</aggregate>
		</subdomain>
		<subdomain name="Customer">
			<aggregate name="Company" business-key="name" event-ttl="-1" snapshot-interval="100" backup-interval-days="0" backup-ttl-days="0">
				<field name="arn" type="String"></field>
				<field name="name" type="String"></field>
				<field name="description" type="String"></field>
				<field name="companySize" type="Int"></field>
				<field name="revenue" type="String"></field>
				<field name="industryLink" type="StringList"></field>
				<command name="Create" create-command="true">
					<trigger source="CreateCompanyRequested" key-field="arn">
						<mapping target="arn" value="arn"></mapping>
						<mapping target="name" value="name"></mapping>
						<mapping target="description" value="description"></mapping>
						<mapping target="companySize" value="companySize"></mapping>
						<mapping target="revenue" value="revenue"></mapping>
						<mapping target="industry" value="industry"></mapping>
						<mapping target="user" value="user"></mapping>
					</trigger>
					<processor type="emit-event" id="AqKpZH" ref="CompanyCreated">
						<mapping target="arn" value="#flow.arn"></mapping>
						<mapping target="name" value="#flow.name"></mapping>
						<mapping target="description" value="#flow.description"></mapping>
						<mapping target="companySize" value="#flow.companySize"></mapping>
						<mapping target="revenue" value="#flow.revenue"></mapping>
						<mapping target="industry" value="#flow.industry"></mapping>
						<mapping target="user" value="#flow.user"></mapping>
					</processor>
					<test-case name="CreateNewCompany" trigger-event="CreateCompanyRequested">
						<input name="arn" value="company:draftsman" type="String"></input>
						<input name="name" value="Draftsman" type="String"></input>
						<input name="description" value="--" type="String"></input>
						<input name="companySize" value="2" type="Int"></input>
						<input name="revenue" value="0" type="String"></input>
						<input name="industry" value="--" type="String"></input>
						<input name="user" value="j.doe" type="String"></input>
						<expected domain-event="CompanyCreated">
							<field value="company:draftsman" name="arn" type="String"></field>
							<field value="Draftsman" name="name" type="String"></field>
							<field value="--" name="description" type="String"></field>
							<field value="0" name="revenue" type="String"></field>
						</expected>
						<expected-state pk="company:draftsman">{
        "arn":"company:draftsman",
        "name":"Draftsman",
        "description":"--",
        "companySize": 2,
        "revenue": "0",
        "industryLink": ["--"]
      }</expected-state>
					</test-case>
					<test-case name="CreateDuplicateCompany" trigger-event="CreateCompanyRequested" expected-processing-status="error">
						<input name="arn" value="company:draftsman" type="String"></input>
						<input name="name" value="Draftsman" type="String"></input>
						<input name="description" value="--" type="String"></input>
						<input name="companySize" value="2" type="Int"></input>
						<input name="revenue" value="0" type="String"></input>
						<input name="industry" value="--" type="String"></input>
						<input name="user" value="j.doe" type="String"></input>
						<state>{
        "arn":"company:draftsman",
        "version":1
      }</state>
					</test-case>
				</command>
				<event-handler on="CompanyCreated" code="self.arn = event.arn|LB|self.name = event.name|LB|self.description = event.description|LB|self.companySize = event.companySize|LB|self.revenue = event.revenue|LB|self.industryLink = event.industry.split(';')|LB|employeeArn = event.arn + &quot;:employee:&quot; + event.user|LB|self.employees[employeeArn] = {|LB|    &quot;arn&quot;: employeeArn,|LB|    &quot;username&quot;: event.user,|LB|    &quot;businessRole&quot;: &quot;administrator&quot;|LB|    |LB|}"></event-handler>
				<nested-object name="regulations" business-key="name">
					<field name="name" type="String"></field>
					<field name="link" type="String"></field>
				</nested-object>
				<nested-object name="businessUnits" business-key="newField">
					<field name="name" type="String"></field>
					<field name="description" type="String"></field>
				</nested-object>
				<nested-object name="employees" business-key="arn">
					<field name="arn" type="String"></field>
					<field name="username" type="String"></field>
					<field name="businessRole" type="String"></field>
				</nested-object>
			</aggregate>
		</subdomain>
	</domain>
	<views>
		<view name="ControlFramework" data-retention-days="-1" exclude-notification="false">
			<field name="arn" type="String" pk="true"></field>
			<field name="description" type="String"></field>
			<field name="name" type="String"></field>
			<field name="category" type="String"></field>
			<field name="edition" type="String"></field>
			<field name="unit" type="String"></field>
			<field name="acronym" type="String"></field>
			<field name="active" type="Boolean"></field>
			<field name="requirements" type="OneToMany" ref="Requirement" authorization="authenticated" foreign-key="#canonical"></field>
			<snapshot-handler id="1xTQuT" sub-domain="Admin" aggregate="ControlFramework" key-mapping="arn" processor="item">
				<mapping target="arn" operand="set" value="arn"></mapping>
				<mapping target="description" operand="set" value="description"></mapping>
				<mapping target="name" operand="set" value="name"></mapping>
				<mapping target="category" operand="set" value="category"></mapping>
				<mapping target="edition" operand="set" value="edition"></mapping>
				<mapping target="unit" operand="set" value="unit"></mapping>
				<mapping target="acronym" operand="set" value="acronym"></mapping>
				<mapping target="active" operand="set" value="active"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="ControlFramework" field-name="get" type="get" authorization="authenticated"></query>
			<query graphql-namespace="ControlFramework" field-name="filter" type="filter" authorization="authenticated"></query>
		</view>
		<view name="User" data-retention-days="-1" exclude-notification="false">
			<field name="username" type="String" pk="true"></field>
			<field name="links" type="ObjectList" ref="UserCompanyLink" authorization="authenticated" foreign-key="username"></field>
			<field name="firstName" type="String"></field>
			<field name="lastName" type="String"></field>
			<snapshot-handler id="svYd9b" sub-domain="Admin" aggregate="User" key-mapping="username" processor="item">
				<mapping target="username" operand="set" value="username"></mapping>
				<mapping target="firstName" operand="set" value="firstName"></mapping>
				<mapping target="lastName" operand="set" value="lastName"></mapping>
				<mapping target="links" operand="convert_items" value="companies" template='{"arn": value["arn"],"employeeArn": value["employeeArn"]}'></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="User" field-name="get" type="get" authorization="user" username-field="key"></query>
		</view>
		<view name="Industry" data-retention-days="-1" exclude-notification="false">
			<field name="arn" type="String" pk="true"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<snapshot-handler id="RLB0hK" sub-domain="Admin" aggregate="Industry" key-mapping="arn" processor="item">
				<mapping target="arn" operand="set" value="arn"></mapping>
				<mapping target="name" operand="set" value="name"></mapping>
				<mapping target="description" operand="set" value="description"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="Industry" field-name="get" type="get" authorization="authenticated"></query>
			<query graphql-namespace="Industry" field-name="filter" type="filter" authorization="authenticated"></query>
		</view>
		<view name="Company" data-retention-days="-1" exclude-notification="false">
			<field name="arn" type="String" pk="true"></field>
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="companySize" type="Int"></field>
			<field name="revenue" type="String"></field>
			<field name="industryLink" type="StringList"></field>
			<field name="employees" type="OneToMany" ref="Employee" authorization="authenticated" foreign-key="#canonical"></field>
			<snapshot-handler id="a8vzJw" sub-domain="Customer" aggregate="Company" key-mapping="arn" processor="item">
				<mapping target="arn" operand="set" value="arn"></mapping>
				<mapping target="name" operand="set" value="name"></mapping>
				<mapping target="description" operand="set" value="description"></mapping>
				<mapping target="companySize" operand="set" value="companySize"></mapping>
				<mapping target="revenue" operand="set" value="revenue"></mapping>
				<mapping target="industryLink" operand="set" value="industryLink"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="Company" field-name="get" type="get" authorization="role" role="#global.extractRoleFromArn(key, 'viewer')"></query>
			<query graphql-namespace="Company" field-name="filter" type="filter" authorization="role" role="#global.extractRoleFromArn(key_begins_with, 'viewer')" use-canonical-search="true"></query>
		</view>
		<view name="UserCompanyLink" data-retention-days="-1" exclude-notification="false">
			<field name="arn" type="String"></field>
			<field name="company" type="ManyToOne" ref="Company" authorization="role" foreign-key="arn" role="#global.extractRoleFromArn(arn, 'viewer')"></field>
			<field name="employeeArn" type="String"></field>
			<field name="employee" type="OneToOne" ref="Employee" authorization="role" foreign-key="employeeArn" role="#global.extractRoleFromArn(employeeArn, 'viewer')"></field>
		</view>
		<view name="Employee" data-retention-days="-1" exclude-notification="false">
			<field name="arn" type="String" pk="true"></field>
			<field name="username" type="String"></field>
			<field name="businessRole" type="String"></field>
			<field name="user" type="ManyToOne" ref="Profile" authorization="authenticated" foreign-key="username"></field>
			<snapshot-handler id="mvobEq" sub-domain="Customer" aggregate="Company" key-mapping="arn" processor="dictionary" dictionary="employees">
				<mapping target="arn" operand="set" value="arn"></mapping>
				<mapping target="username" operand="set" value="username"></mapping>
				<mapping target="businessRole" operand="set" value="businessRole"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
		</view>
		<view name="Requirement" data-retention-days="-1" exclude-notification="false">
			<field name="name" type="String"></field>
			<field name="description" type="String"></field>
			<field name="mandatory" type="Boolean"></field>
			<field name="summary" type="String"></field>
			<field name="arn" type="String" pk="true"></field>
			<snapshot-handler id="73vD0z" sub-domain="Admin" aggregate="Requirement" key-mapping="arn" processor="item">
				<mapping target="name" operand="set" value="name"></mapping>
				<mapping target="description" operand="set" value="description"></mapping>
				<mapping target="mandatory" operand="set" value="mandatory"></mapping>
				<mapping target="summary" operand="set" value="summary"></mapping>
				<mapping target="arn" operand="set" value="arn"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="Requirement" field-name="get" type="get" authorization="authenticated"></query>
			<query graphql-namespace="Requirement" field-name="filter" type="filter" authorization="authenticated"></query>
		</view>
		<view name="Profile" data-retention-days="-1" exclude-notification="false">
			<field name="username" type="String" pk="true"></field>
			<field name="firstName" type="String"></field>
			<field name="lastName" type="String"></field>
			<snapshot-handler id="71tqcg" sub-domain="Admin" aggregate="User" key-mapping="username" processor="item">
				<mapping target="username" operand="set" value="username"></mapping>
				<mapping target="firstName" operand="set" value="firstName"></mapping>
				<mapping target="lastName" operand="set" value="lastName"></mapping>
				<delete condition="#snapshot.isDeleted != ''"></delete>
			</snapshot-handler>
			<query graphql-namespace="Profile" field-name="get" type="get" authorization="authenticated"></query>
			<query graphql-namespace="Profile" field-name="filter" type="filter" authorization="authenticated"></query>
		</view>
	</views>
	<projections>
	</projections>
	<notifiers>
		<notifier name="DemoUsers">
			<trigger source="@cron(0 * * * ? *)">
				<mapping target="dummy" value="#'dummy'"></mapping>
			</trigger>
			<activity type="set-variable" id="6fz0Yx" name="role" expression="#'administrator'"></activity>
			<activity type="set-variable" id="CqaYqy" name="bo" expression="#'hanssen'" fail-silent="false"></activity>
			<activity type="set-variable" id="We51UX" name="delano" expression="#'delano'"></activity>
			<activity type="create-iam-group" id="kj95dD" group-name="#flow.role" fail-silent="true"></activity>
			<activity type="add-user-to-iam-group" id="bLO2pB" group-name="#flow.role" username="#flow.bo" fail-silent="true"></activity>
			<activity type="add-user-to-iam-group" id="CvSj37" group-name="#flow.role" username="#flow.delano" fail-silent="true"></activity>
		</notifier>
		<notifier name="InitializeSystemUser">
			<trigger source="@afterDeployment">
				<mapping target="dummy" value="#''"></mapping>
			</trigger>
			<activity type="iam-create-systemuser" fail-silent="true" id="vMB9LZ"></activity>
		</notifier>
		<notifier name="PrepareCompanyTenant">
			<trigger source="CompanyCreated">
				<mapping target="arn" value="arn"></mapping>
				<mapping target="user" value="user"></mapping>
			</trigger>
			<activity type="code" id="4x5IYY" python-file="lib/AccessManagement.py" handler="retrieve_all_roles" condition=""></activity>
			<activity type="set-variable" id="9V4dG1" name="systemUser" expression="#'system-user'"></activity>
			<activity type="loop" id="ytmySk" array="#flow.roles">
				<activity type="set-variable" id="ILrv7Y" name="role" expression="#item"></activity>
				<activity type="create-iam-group" id="ONx6ky" group-name="#flow.role"></activity>
				<activity type="add-user-to-iam-group" id="dri70C" group-name="#flow.role" username="#flow.user"></activity>
				<activity type="add-user-to-iam-group" id="jBKEw3" group-name="#flow.role" username="#flow.systemUser"></activity>
			</activity>
		</notifier>
	</notifiers>
	<functional-scenarios clean-db="true" clean-iam="true" minimum-event-coverage="80" minimum-view-coverage="80">
	</functional-scenarios>
</draftsman>